<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SpatialEcoTyper">
<title>Development of NMF Models for Spatial Ecotype Recovery • SpatialEcoTyper</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Development of NMF Models for Spatial Ecotype Recovery">
<meta property="og:description" content="SpatialEcoTyper">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light" data-bs-theme="default"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SpatialEcoTyper</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/SingleSample.html">Discovery of Spatial Ecotypes from a Single Sample</a>
    <a class="dropdown-item" href="../articles/Integration.html">Discovery of Spatial Ecotypes from Multiple Samples</a>
    <a class="dropdown-item" href="../articles/TrainRecoveryModels.html">Development of NMF Models for Spatial Ecotype Recovery</a>
    <a class="dropdown-item" href="../articles/Recovery_Spatial.html">Recovery of Spatial Ecotypes from Spatial Transcriptomics Data</a>
    <a class="dropdown-item" href="../articles/Recovery_scRNA.html">Recovery of Spatial Ecotypes from Single-Cell Gene Expression Data</a>
    <a class="dropdown-item" href="../articles/Recovery_Bulk.html">Recovery of Spatial Ecotypes from Bulk Gene Expression Data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">R functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Development of NMF Models for Spatial Ecotype Recovery</h1>
            
      
      <small class="dont-index">Source: <a href="https://digitalcytometry.github/SpatialEcoTypervignettes/TrainRecoveryModels.Rmd" class="external-link"><code>vignettes/TrainRecoveryModels.Rmd</code></a></small>
      <div class="d-none name"><code>TrainRecoveryModels.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="development-of-se-recovery-models">Development of SE recovery models<a class="anchor" aria-label="anchor" href="#development-of-se-recovery-models"></a>
</h2>
<p>After performing Spatial EcoTyper analysis, users can develop machine
learning models to recover spatial ecotypes (SEs) from various types of
gene expression data, including spatial transcriptomics and single-cell
RNA-seq.</p>
<p><strong>First load required packages for this vignette</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://googledrive.tidyverse.org" class="external-link">googledrive</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://renozao.github.io/NMF/" class="external-link">NMF</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://digitalcytometry.github/SpatialEcoTyper" class="external-link">SpatialEcoTyper</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="loading-data">Loading data<a class="anchor" aria-label="anchor" href="#loading-data"></a>
</h3>
<p>In this tutorial, we will use the Vizgen MERSCOPE data of a melanoma
sample to demonstrate the process of training SE recovery models. The
training requires a gene expression matrix, cell type annotations, and
SE annotations. The cell type and SE annotations can be obtained from
the SpatialEcoTyper results, which is available in <a href="https://drive.google.com/open?id=1mKz0IHHUGYpS7GpDuNh93YAEPLbd-vTE&amp;usp=drive_fs" class="external-link">Melanoma1_subset_SpatialEcoTyper_results.rds</a>.
The gene expression matrix for the melanoma sample can be downloaded
from <a href="https://drive.google.com/open?id=17K5XR7VEvxN9walV4RtaLOR2cBRG-aMh&amp;usp=drive_fs" class="external-link">here</a>.</p>
<p><strong>Download the data from Google Drive</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://googledrive.tidyverse.org/reference/drive_deauth.html" class="external-link">drive_deauth</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Disable Google sign-in requirement</span></span>
<span><span class="fu"><a href="https://googledrive.tidyverse.org/reference/drive_download.html" class="external-link">drive_download</a></span><span class="op">(</span><span class="fu"><a href="https://googledrive.tidyverse.org/reference/drive_id.html" class="external-link">as_id</a></span><span class="op">(</span><span class="st">"13Rc5Rsu8jbnEYYfUse-xQ7ges51LcI7n"</span><span class="op">)</span>, <span class="st">"HumanMelanomaPatient1_subset_counts.tsv.gz"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://googledrive.tidyverse.org/reference/drive_download.html" class="external-link">drive_download</a></span><span class="op">(</span><span class="fu"><a href="https://googledrive.tidyverse.org/reference/drive_id.html" class="external-link">as_id</a></span><span class="op">(</span><span class="st">"1mKz0IHHUGYpS7GpDuNh93YAEPLbd-vTE"</span><span class="op">)</span>, <span class="st">"Melanoma1_subset_SpatialEcoTyper_results.rds"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>Load gene expression matrix</strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"HumanMelanomaPatient1_subset_counts.tsv.gz"</span>, </span>
<span>                sep <span class="op">=</span> <span class="st">"\t"</span>,header <span class="op">=</span> <span class="cn">TRUE</span>, data.table <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">scdata</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">scdata</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">scdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">scdata</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">scdata</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          HumanMelanomaPatient1__cell_3655 HumanMelanomaPatient1__cell_3657</span></span>
<span><span class="co">## PDK4                                    0                                1</span></span>
<span><span class="co">## TNFRSF17                                0                                0</span></span>
<span><span class="co">## ICAM3                                   0                                0</span></span>
<span><span class="co">## FAP                                     1                                0</span></span>
<span><span class="co">## GZMB                                    0                                0</span></span>
<span><span class="co">## TSC2                                    0                                0</span></span>
<span><span class="co">##          HumanMelanomaPatient1__cell_3658 HumanMelanomaPatient1__cell_3660</span></span>
<span><span class="co">## PDK4                                    1                                0</span></span>
<span><span class="co">## TNFRSF17                                0                                0</span></span>
<span><span class="co">## ICAM3                                   0                                0</span></span>
<span><span class="co">## FAP                                     0                                0</span></span>
<span><span class="co">## GZMB                                    0                                0</span></span>
<span><span class="co">## TSC2                                    0                                0</span></span>
<span><span class="co">##          HumanMelanomaPatient1__cell_3661</span></span>
<span><span class="co">## PDK4                                    0</span></span>
<span><span class="co">## TNFRSF17                                0</span></span>
<span><span class="co">## ICAM3                                   0</span></span>
<span><span class="co">## FAP                                     0</span></span>
<span><span class="co">## GZMB                                    0</span></span>
<span><span class="co">## TSC2                                    0</span></span></code></pre>
<p><strong>Load cell type and SE annotations</strong></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">se_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"Melanoma1_subset_SpatialEcoTyper_results.rds"</span><span class="op">)</span></span>
<span><span class="va">scmeta</span> <span class="op">=</span> <span class="va">se_results</span><span class="op">$</span><span class="va">metadata</span></span>
<span><span class="va">scmeta</span><span class="op">$</span><span class="va">SE</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">scmeta</span><span class="op">$</span><span class="va">SE</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="st">"NonSE"</span> <span class="co">## cells with NA predictions were assigned into the NonSE group</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">scmeta</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CellType"</span>, <span class="st">"SE"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                                    CellType    SE</span></span>
<span><span class="co">## HumanMelanomaPatient1__cell_3655 Fibroblast NonSE</span></span>
<span><span class="co">## HumanMelanomaPatient1__cell_3657 Fibroblast   SE7</span></span>
<span><span class="co">## HumanMelanomaPatient1__cell_3658 Fibroblast   SE7</span></span>
<span><span class="co">## HumanMelanomaPatient1__cell_3660 Fibroblast   SE7</span></span>
<span><span class="co">## HumanMelanomaPatient1__cell_3661 Fibroblast   SE1</span></span>
<span><span class="co">## HumanMelanomaPatient1__cell_3663 Fibroblast NonSE</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="data-normalization">Data normalization<a class="anchor" aria-label="anchor" href="#data-normalization"></a>
</h3>
<p>The data can be normalized using <a href="https://satijalab.org/seurat/articles/seurat5_spatial_vignette_2" class="external-link">SCTransform</a>
or <a href="https://satijalab.org/seurat/reference/normalizedata" class="external-link">NormalizeData</a>.</p>
<p>Here, we are normalizing using SCTransform normalization. We
recommend to install the glmGamPoi package for faster computation.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="st">"glmGamPoi"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/installed.packages.html" class="external-link">installed.packages</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu">BiocManager</span><span class="fu">::</span><span class="fu"><a href="https://bioconductor.github.io/BiocManager/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="st">"glmGamPoi"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">tmpobj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/CreateSeuratObject.html" class="external-link">CreateSeuratObject</a></span><span class="op">(</span><span class="va">scdata</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://satijalab.org/seurat/reference/SCTransform.html" class="external-link">SCTransform</a></span><span class="op">(</span>clip.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">seurat_version</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\..*"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"SeuratObject"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="va">seurat_version</span><span class="op">&lt;</span><span class="fl">5</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">normdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mojaveazure.github.io/seurat-object/reference/AssayData.html" class="external-link">GetAssayData</a></span><span class="op">(</span><span class="va">tmpobj</span>, <span class="st">"data"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="kw">else</span><span class="op">{</span></span>
<span>  <span class="va">normdata</span> <span class="op">&lt;-</span> <span class="va">tmpobj</span><span class="op">[[</span><span class="st">"SCT"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="op">}</span></span></code></pre></div>
<details open><summary>
To use <code>NormalizeData</code> for the normalization:
</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">normdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/NormalizeData.html" class="external-link">NormalizeData</a></span><span class="op">(</span><span class="va">scdata</span><span class="op">)</span></span></code></pre></div>
</details>
</div>
<div class="section level3">
<h3 id="training">Training<a class="anchor" aria-label="anchor" href="#training"></a>
</h3>
<p>The <code>NMFGenerateWList</code> function will be used to train
cell-type specific NMF models for recovering SEs. Prior to NMF, each
gene is scaled to mean 0 and unit variance within each cell
type-specific expression matrix. To satisfy the non-negativity
requirement of NMF, the cell type-specific expression matrices are
individually processed using posneg transformation, which converts each
expression matrix into two matrices, one containing only positive values
and the other containing only negative values with the sign inverted.
The two matrices are subsequently concatenated to produce the training
data. The <code>NMFGenerateWList</code> function will return a list of
<code>feature × SE</code> matrices, each representing a cell
type-specific gene signature matrix with rows as features and columns as
SEs.</p>
<p><strong>Note</strong>: By default, the <code>NMFGenerateWList</code>
selects the top 2000 variable features (<code>nfeature</code> argument)
and down-samples 2500 cells (<code>downsample</code> argument) within
each cell type for training. After training, it retains 50 genes per SE
(<code>nfeature.per.se</code> argument) in the model. Users can tune the
parameters accordingly.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Before training, ensure that the rows in scmeta matches the columns in normdata.</span></span>
<span><span class="va">normdata</span> <span class="op">=</span> <span class="va">normdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">scmeta</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">normdata</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">Ws</span> <span class="op">=</span> <span class="fu"><a href="../reference/NMFGenerateWList.html">NMFGenerateWList</a></span><span class="op">(</span><span class="va">normdata</span>, <span class="va">scmeta</span>, </span>
<span>                      CellType <span class="op">=</span> <span class="st">"CellType"</span>, </span>
<span>                      SE <span class="op">=</span> <span class="st">"SE"</span><span class="op">)</span></span>
<span><span class="co">## This step would take ~3 mins for the demo.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">Ws</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "list"</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Ws</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "B"           "CD4T"        "CD8T"        "DC"          "Endothelial"</span></span>
<span><span class="co">## [6] "Fibroblast"  "Macrophage"  "NK"          "Plasma"</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Ws</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                   SE4       SE3       SE0       SE9       SE5       SE8</span></span>
<span><span class="co">## EGR1__pos   0.3910861 0.5649324 0.8110623 0.8008798 0.5884111 0.2439976</span></span>
<span><span class="co">## BCL2L1__pos 0.3381409 0.7274791 0.4418877 0.3822232 0.5033130 0.4884480</span></span>
<span><span class="co">## CDK2__pos   0.2549690 0.2412425 0.1896065 0.2352045 0.4031756 0.2829902</span></span>
<span><span class="co">## CSF1__pos   0.3311551 0.4673067 0.5922863 0.4450299 0.6127305 0.3744147</span></span>
<span><span class="co">## NFKB2__neg  0.3562345 0.6160507 0.6460664 0.4697886 0.5957061 0.3333035</span></span>
<span><span class="co">## CCR7__neg   0.3054937 0.4672086 0.5281488 0.4383967 0.5428941 0.3927518</span></span>
<span><span class="co">##                   SE7       SE6       SE2       SE1     NonSE</span></span>
<span><span class="co">## EGR1__pos   0.5115564 0.3531597 0.3082490 1.1469010 0.6678290</span></span>
<span><span class="co">## BCL2L1__pos 0.5888983 0.8348031 0.6014256 0.6267735 0.6810903</span></span>
<span><span class="co">## CDK2__pos   0.3404783 2.0453563 0.7066313 0.2372814 1.1674323</span></span>
<span><span class="co">## CSF1__pos   0.3995627 0.7899763 0.5005422 0.6181742 0.8853052</span></span>
<span><span class="co">## NFKB2__neg  0.8678156 0.3760428 0.4234894 0.6514203 0.6677322</span></span>
<span><span class="co">## CCR7__neg   0.5773287 0.6990205 0.5667443 0.7769882 0.6934580</span></span></code></pre>
<p>The resulting W matrices could be used to recover SEs from spatial
transcriptomics and single-cell RNA-seq, by using the
<code>RecoverSE</code> function. The detailed documentation for SE
recovery is available at <a href="Recovery_scRNA.html">Recovery of
Spatial Ecotypes from Single-Cell Gene Expression Data</a> and <a href="Recovery_Spatial.html">Recovery of Spatial Ecotypes from Spatial
Transcriptomics Data</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="development-of-se-deconvolution-model">Development of SE deconvolution model<a class="anchor" aria-label="anchor" href="#development-of-se-deconvolution-model"></a>
</h2>
<p>Users can also develop an NMF model to deconvolve SEs from bulk gene
expression data. The training data can be pseudo-bulk mixtures by
aggregating single-cell transcriptomics. In this tutorial, we will
create pseudo-bulk mixtures from single-cell RNA-seq data of a melanoma
sample, which is also used in the tutorial <a href="Recovery_scRNA.html">Recovery of Spatial Ecotypes from Single-Cell
Gene Expression Data</a>. The raw count data is available at <a href="https://drive.google.com/open?id=15n9zlXed74oeGaO1pythOOM_iWIfuMn2&amp;usp=drive_fs" class="external-link">Melanoma_WU2161_counts.rds</a>
and SE recovery results are available at <a href="https://drive.google.com/open?id=15apmSDhcANjx3i05LIFIm01gelbP7etA&amp;usp=drive_fs" class="external-link">Melanoma_WU2161_RecoveredSEs.rds</a>.</p>
<div class="section level3">
<h3 id="loading-data-1">Loading data<a class="anchor" aria-label="anchor" href="#loading-data-1"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download single-cell gene expression matrix and SE recovery results.</span></span>
<span><span class="fu"><a href="https://googledrive.tidyverse.org/reference/drive_download.html" class="external-link">drive_download</a></span><span class="op">(</span><span class="fu"><a href="https://googledrive.tidyverse.org/reference/drive_id.html" class="external-link">as_id</a></span><span class="op">(</span><span class="st">"15n9zlXed74oeGaO1pythOOM_iWIfuMn2"</span><span class="op">)</span>, <span class="st">"Melanoma_WU2161_counts.rds"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://googledrive.tidyverse.org/reference/drive_download.html" class="external-link">drive_download</a></span><span class="op">(</span><span class="fu"><a href="https://googledrive.tidyverse.org/reference/drive_id.html" class="external-link">as_id</a></span><span class="op">(</span><span class="st">"1nzhKQM6HtX_rzzn3edSQsbodFBO5ycYG"</span><span class="op">)</span>, <span class="st">"Melanoma_WU2161_RecoveredSEs.rds"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load single-cell gene expression matrix.</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"Melanoma_WU2161_counts.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">counts</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 27425  1337</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load SE recovery results</span></span>
<span><span class="va">SEs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"Melanoma_WU2161_RecoveredSEs.rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">SEs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1337</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">SEs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## SEs</span></span>
<span><span class="co">## NonSE  SE01  SE02  SE03  SE04  SE05  SE06  SE07  SE08  SE09  SE10  SE11 </span></span>
<span><span class="co">##   593    71    72    82    24    62    29   174    75    28    71    56</span></span></code></pre>
<p>Tab-delimited files can be efficiently loaded into R using the
<code>fread</code> function from the <code>data.table</code> package,
while sparse matrix files in the .mtx format can be imported using the
<code>ReadMtx</code> function from the <code>Seurat</code> package.</p>
<p><strong>Note</strong>: For demonstration purposes, we used 1,337
cells grouped into SEs to create pseudo-bulk mixtures. While this
limited cell number offers a basic example, it may not fully capture the
diverse characteristics of SEs, potentially affecting the robustness of
model training and subsequent SE recovery. In practice, we recommend
using a more comprehensive dataset that accurately reflects the
properties of SEs, ensuring that the training process results in a
reliable recovery model.</p>
</div>
<div class="section level3">
<h3 id="creating-pseudobulk-data">Creating pseudobulk data<a class="anchor" aria-label="anchor" href="#creating-pseudobulk-data"></a>
</h3>
<p>The <code>CreatePseudobulks</code> function will be used to create
pseudo-bulk mixtures from single-cell (spatial) transcriptomics data
with all cells grouped into SEs. It samples cell fractions from a
Gaussian distribution, sets negative fractions to 0 and re-normalizes
fractions to sum to 1 across all SEs. Based on the resulting fractions,
it samples 1,000 cells per pseudo-bulk mixture with replacement,
aggregates their transcriptomes in non-log linear space, and normalize
the resulting mixture to logarithm CPM using Seurat’s
<code>NormalizeData</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">=</span> <span class="fu"><a href="../reference/CreatePseudobulks.html">CreatePseudobulks</a></span><span class="op">(</span>counts <span class="op">=</span> <span class="va">counts</span>, groups <span class="op">=</span> <span class="va">SEs</span>, n_mixtures <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">Mixtures</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="co">## Gene expression matrix of pseudobulks</span></span></code></pre></div>
<pre><code><span><span class="co">## 6 x 5 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">##             Pseudobulk1 Pseudobulk2  Pseudobulk3  Pseudobulk4 Pseudobulk5</span></span>
<span><span class="co">## AL627309.1 0.0152838696 0.019781052 0.0322557735 0.0246361505 0.019438028</span></span>
<span><span class="co">## AL627309.5 0.0592082167 0.073517456 0.0522678959 0.0469554550 0.104839146</span></span>
<span><span class="co">## AP006222.2 0.0007942805 0.005133306 0.0019503855 0.0005122298 0.004213244</span></span>
<span><span class="co">## AC114498.1 0.0027652787 .           0.0009226095 .            .          </span></span>
<span><span class="co">## AL669831.2 0.0007398640 .           .            .            0.002220167</span></span>
<span><span class="co">## LINC01409  0.0279535801 0.028035802 0.0413323771 0.0393270143 0.020280342</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">Fracs</span><span class="op">)</span> <span class="co">## SE fractions in pseudobulks</span></span></code></pre></div>
<pre><code><span><span class="co">##                  NonSE       SE01       SE02       SE03       SE04       SE05</span></span>
<span><span class="co">## Pseudobulk1 0.14628583 0.07057882 0.02863246 0.08491832 0.00000000 0.12696832</span></span>
<span><span class="co">## Pseudobulk2 0.07828169 0.02067925 0.06708225 0.09161687 0.01555719 0.12592154</span></span>
<span><span class="co">## Pseudobulk3 0.10832075 0.05666519 0.06256173 0.12405662 0.02595538 0.07936429</span></span>
<span><span class="co">## Pseudobulk4 0.01773584 0.06634549 0.07316187 0.10451748 0.04935745 0.07491514</span></span>
<span><span class="co">## Pseudobulk5 0.02702021 0.11633782 0.03466361 0.04860990 0.15198454 0.16907686</span></span>
<span><span class="co">## Pseudobulk6 0.08406714 0.08759837 0.02683276 0.08219938 0.11774277 0.11328168</span></span>
<span><span class="co">##                   SE06       SE07       SE08       SE09       SE10       SE11</span></span>
<span><span class="co">## Pseudobulk1 0.10662882 0.08162828 0.08131545 0.06964312 0.11215770 0.09124290</span></span>
<span><span class="co">## Pseudobulk2 0.13256977 0.05167444 0.12530907 0.09094452 0.15698157 0.04338185</span></span>
<span><span class="co">## Pseudobulk3 0.05302578 0.10951767 0.12761146 0.07796874 0.10373592 0.07121646</span></span>
<span><span class="co">## Pseudobulk4 0.11377325 0.14604491 0.11028648 0.08481379 0.04368832 0.11535998</span></span>
<span><span class="co">## Pseudobulk5 0.07624082 0.03808918 0.11383699 0.10448038 0.03177527 0.08788440</span></span>
<span><span class="co">## Pseudobulk6 0.10360301 0.06599602 0.05785827 0.05729621 0.12522835 0.07829604</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="training-1">Training<a class="anchor" aria-label="anchor" href="#training-1"></a>
</h3>
<p>The <code>NMFGenerateW</code> function will be used to train an NMF
model for SE deconvolution based on the provided SE fractions and gene
expression matrix. Before applying NMF, each gene’s expression is scaled
to have a mean of 0 and unit variance (recommended). To meet the
non-negativity requirement of NMF, the expression matrix is transformed
using the posneg method. This transformation splits the expression
matrix into two matrices: one containing only positive values and the
other containing the absolute values of the negative values. These two
matrices are then concatenated to form the final training data for the
NMF model.</p>
<p><strong>Note</strong>: By default, the <code>NMFGenerateW</code>
selects the top 2000 variable features (<code>nfeature</code> argument)
for training. After training, it retains 50 genes per SE
(<code>nfeature.per.se</code> argument) in the model. Users can tune the
parameters accordingly.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">W</span> <span class="op">=</span> <span class="fu"><a href="../reference/NMFGenerateW.html">NMFGenerateW</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">Fracs</span><span class="op">)</span>, <span class="va">result</span><span class="op">$</span><span class="va">Mixtures</span><span class="op">)</span></span>
<span><span class="co">## This step would take ~1 min for the demo.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                      NonSE         SE01         SE02         SE03         SE04</span></span>
<span><span class="co">## IGLV1-51__neg 1.584816e-06 4.011402e-01 1.152091e+00 2.220446e-16 1.098698e+00</span></span>
<span><span class="co">## PTPRG__pos    2.220446e-16 2.220446e-16 2.220446e-16 2.220446e-16 5.707818e+00</span></span>
<span><span class="co">## IGLV2-23__pos 7.600571e-07 9.552708e-01 1.347892e+00 2.220446e-16 2.211103e-01</span></span>
<span><span class="co">## MMP19__pos    2.220446e-16 2.220446e-16 5.850866e-07 2.220446e-16 5.657781e+00</span></span>
<span><span class="co">## PLCE1__pos    2.220446e-16 2.220446e-16 2.220446e-16 2.220446e-16 5.634928e+00</span></span>
<span><span class="co">## IGHV4-34__pos 2.220446e-16 1.053691e+00 1.726078e-12 1.260519e-12 2.220446e-16</span></span>
<span><span class="co">##                       SE05         SE06         SE07         SE08         SE09</span></span>
<span><span class="co">## IGLV1-51__neg 1.295424e+00 1.397941e-05 1.416938e-01 3.417918e-02 4.218161e-16</span></span>
<span><span class="co">## PTPRG__pos    2.220446e-16 2.220446e-16 2.220446e-16 2.220446e-16 2.220446e-16</span></span>
<span><span class="co">## IGLV2-23__pos 2.061021e-06 2.220446e-16 3.049361e+00 1.738312e-08 1.062675e-01</span></span>
<span><span class="co">## MMP19__pos    6.872540e-10 2.220446e-16 2.220446e-16 2.220446e-16 2.220446e-16</span></span>
<span><span class="co">## PLCE1__pos    2.220446e-16 2.220446e-16 2.220446e-16 2.220446e-16 2.220446e-16</span></span>
<span><span class="co">## IGHV4-34__pos 2.220446e-16 2.220446e-16 5.360504e-01 4.020009e+00 2.220446e-16</span></span>
<span><span class="co">##                       SE10         SE11</span></span>
<span><span class="co">## IGLV1-51__neg 2.220446e-16 1.691326e+00</span></span>
<span><span class="co">## PTPRG__pos    2.220446e-16 2.220446e-16</span></span>
<span><span class="co">## IGLV2-23__pos 2.220446e-16 2.220446e-16</span></span>
<span><span class="co">## MMP19__pos    2.220446e-16 2.220446e-16</span></span>
<span><span class="co">## PLCE1__pos    2.220446e-16 2.220446e-16</span></span>
<span><span class="co">## IGHV4-34__pos 2.220446e-16 2.220446e-16</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Save the model for late use.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">W</span>, <span class="st">"SE_Deconvolution_W.rds"</span><span class="op">)</span></span></code></pre></div>
<p>The resulting W matrix can be used to infer SE abundances from bulk
gene expression profiles, by using the <code>DeconvoluteSE</code>
function. The detailed documentation for SE deconvolution is available
at <a href="Recovery_Bulk.html">Recovery of Spatial Ecotypes from Bulk
Gene Expression Data</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<p>The session info allows users to replicate the exact environment and
identify potential discrepancies in package versions or configurations
that might be causing problems.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.2.3 (2023-03-15)</span></span>
<span><span class="co">## Platform: x86_64-apple-darwin13.4.0 (64-bit)</span></span>
<span><span class="co">## Running under: macOS Big Sur ... 10.16</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS/LAPACK: /Users/wzhang39/miniconda3/envs/SpatialEcoTyper/lib/libopenblasp-r0.3.27.dylib</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] parallel  stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] SpatialEcoTyper_0.0.4 RANN_2.6.2            Matrix_1.6-5         </span></span>
<span><span class="co">##  [4] dplyr_1.1.4           data.table_1.15.4     NMF_0.28             </span></span>
<span><span class="co">##  [7] Biobase_2.58.0        BiocGenerics_0.44.0   cluster_2.1.6        </span></span>
<span><span class="co">## [10] rngtools_1.5.2        registry_0.5-1        SeuratObject_5.0.2   </span></span>
<span><span class="co">## [13] Seurat_4.4.0          googledrive_2.1.1    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] circlize_0.4.16        spatstat.univar_3.0-0  spam_2.10-0           </span></span>
<span><span class="co">##   [4] systemfonts_1.1.0      plyr_1.8.9             igraph_2.0.3          </span></span>
<span><span class="co">##   [7] lazyeval_0.2.2         sp_2.1-4               splines_4.2.3         </span></span>
<span><span class="co">##  [10] listenv_0.9.1          scattermore_1.2        ggplot2_3.5.1         </span></span>
<span><span class="co">##  [13] gridBase_0.4-7         digest_0.6.36          foreach_1.5.2         </span></span>
<span><span class="co">##  [16] htmltools_0.5.8.1      fansi_1.0.6            magrittr_2.0.3        </span></span>
<span><span class="co">##  [19] memoise_2.0.1          tensor_1.5             doParallel_1.0.17     </span></span>
<span><span class="co">##  [22] ROCR_1.0-11            ComplexHeatmap_2.14.0  globals_0.16.3        </span></span>
<span><span class="co">##  [25] matrixStats_1.3.0      R.utils_2.12.3         pkgdown_2.0.9         </span></span>
<span><span class="co">##  [28] spatstat.sparse_3.1-0  colorspace_2.1-1       ggrepel_0.9.5         </span></span>
<span><span class="co">##  [31] textshaping_0.4.0      xfun_0.45              crayon_1.5.3          </span></span>
<span><span class="co">##  [34] jsonlite_1.8.8         progressr_0.14.0       spatstat.data_3.1-2   </span></span>
<span><span class="co">##  [37] survival_3.7-0         zoo_1.8-12             iterators_1.0.14      </span></span>
<span><span class="co">##  [40] glue_1.7.0             polyclip_1.10-7        gtable_0.3.5          </span></span>
<span><span class="co">##  [43] gargle_1.5.2           leiden_0.4.3.1         GetoptLong_1.0.5      </span></span>
<span><span class="co">##  [46] shape_1.4.6.1          future.apply_1.11.2    abind_1.4-5           </span></span>
<span><span class="co">##  [49] scales_1.3.0           spatstat.random_3.3-1  miniUI_0.1.1.1        </span></span>
<span><span class="co">##  [52] Rcpp_1.0.12            viridisLite_0.4.2      xtable_1.8-4          </span></span>
<span><span class="co">##  [55] clue_0.3-65            reticulate_1.38.0      dotCall64_1.1-1       </span></span>
<span><span class="co">##  [58] stats4_4.2.3           htmlwidgets_1.6.4      httr_1.4.7            </span></span>
<span><span class="co">##  [61] RColorBrewer_1.1-3     ica_1.0-3              R.methodsS3_1.8.2     </span></span>
<span><span class="co">##  [64] pkgconfig_2.0.3        sass_0.4.9             uwot_0.2.2            </span></span>
<span><span class="co">##  [67] deldir_2.0-4           utf8_1.2.4             tidyselect_1.2.1      </span></span>
<span><span class="co">##  [70] rlang_1.1.4            reshape2_1.4.4         later_1.3.2           </span></span>
<span><span class="co">##  [73] munsell_0.5.1          tools_4.2.3            cachem_1.1.0          </span></span>
<span><span class="co">##  [76] cli_3.6.3              generics_0.1.3         ggridges_0.5.6        </span></span>
<span><span class="co">##  [79] evaluate_0.24.0        stringr_1.5.1          fastmap_1.2.0         </span></span>
<span><span class="co">##  [82] yaml_2.3.8             ragg_1.3.2             goftest_1.2-3         </span></span>
<span><span class="co">##  [85] knitr_1.47             fs_1.6.4               fitdistrplus_1.2-1    </span></span>
<span><span class="co">##  [88] purrr_1.0.2            pbapply_1.7-2          future_1.34.0         </span></span>
<span><span class="co">##  [91] nlme_3.1-165           mime_0.12              R.oo_1.26.0           </span></span>
<span><span class="co">##  [94] compiler_4.2.3         rstudioapi_0.16.0      plotly_4.10.4         </span></span>
<span><span class="co">##  [97] curl_5.1.0             png_0.1-8              spatstat.utils_3.1-0  </span></span>
<span><span class="co">## [100] tibble_3.2.1           bslib_0.7.0            stringi_1.8.4         </span></span>
<span><span class="co">## [103] desc_1.4.3             lattice_0.22-6         vctrs_0.6.5           </span></span>
<span><span class="co">## [106] pillar_1.9.0           lifecycle_1.0.4        BiocManager_1.30.24   </span></span>
<span><span class="co">## [109] GlobalOptions_0.1.2    spatstat.geom_3.3-2    lmtest_0.9-40         </span></span>
<span><span class="co">## [112] jquerylib_0.1.4        RcppAnnoy_0.0.22       cowplot_1.1.3         </span></span>
<span><span class="co">## [115] irlba_2.3.5.1          httpuv_1.6.15          patchwork_1.2.0       </span></span>
<span><span class="co">## [118] R6_2.5.1               promises_1.3.0         KernSmooth_2.23-24    </span></span>
<span><span class="co">## [121] gridExtra_2.3          IRanges_2.32.0         parallelly_1.38.0     </span></span>
<span><span class="co">## [124] codetools_0.2-20       MASS_7.3-60.0.1        rjson_0.2.21          </span></span>
<span><span class="co">## [127] withr_3.0.0            sctransform_0.4.1      S4Vectors_0.36.2      </span></span>
<span><span class="co">## [130] grid_4.2.3             tidyr_1.3.1            rmarkdown_2.27        </span></span>
<span><span class="co">## [133] Rtsne_0.17             spatstat.explore_3.3-2 shiny_1.8.1.1</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://profiles.stanford.edu/wubing-zhang" class="external-link">Wubing Zhang</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
